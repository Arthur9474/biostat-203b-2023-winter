<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="YOUR NAME and UID">

<title>Biostat 203B Homework 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="203BHW3_files/libs/clipboard/clipboard.min.js"></script>
<script src="203BHW3_files/libs/quarto-html/quarto.js"></script>
<script src="203BHW3_files/libs/quarto-html/popper.min.js"></script>
<script src="203BHW3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="203BHW3_files/libs/quarto-html/anchor.min.js"></script>
<link href="203BHW3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="203BHW3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="203BHW3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="203BHW3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="203BHW3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#q1.-compile-the-icu-cohort-in-hw2-from-the-google-bigquery-database" id="toc-q1.-compile-the-icu-cohort-in-hw2-from-the-google-bigquery-database" class="nav-link active" data-scroll-target="#q1.-compile-the-icu-cohort-in-hw2-from-the-google-bigquery-database"><span class="toc-section-number">1</span>  Q1. Compile the ICU cohort in HW2 from the Google BigQuery database</a></li>
  <li><a href="#q2.-shiny-app" id="toc-q2.-shiny-app" class="nav-link" data-scroll-target="#q2.-shiny-app"><span class="toc-section-number">2</span>  Q2. Shiny app</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Biostat 203B Homework 3</h1>
<p class="subtitle lead">Due Mar 1 @ 11:59PM</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>YOUR NAME and UID </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Display machine information:</p>
<p>Load database libraries and the tidyverse frontend:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bigrquery)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19044)

Matrix products: default

locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] shiny_1.7.4     forcats_0.5.2   stringr_1.5.0   dplyr_1.0.10   
 [5] purrr_0.3.5     readr_2.1.3     tidyr_1.2.1     tibble_3.1.8   
 [9] ggplot2_3.4.0   tidyverse_1.3.2 lubridate_1.9.1 DBI_1.1.3      
[13] dbplyr_2.1.1    bigrquery_1.4.0

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.9          assertthat_0.2.1    digest_0.6.30      
 [4] utf8_1.2.2          mime_0.12           R6_2.5.1           
 [7] cellranger_1.1.0    backports_1.4.1     reprex_2.0.2       
[10] evaluate_0.18       httr_1.4.4          pillar_1.8.1       
[13] rlang_1.0.6         googlesheets4_1.0.1 readxl_1.4.1       
[16] rstudioapi_0.14     rmarkdown_2.18      googledrive_2.0.0  
[19] htmlwidgets_1.6.1   bit_4.0.4           munsell_0.5.0      
[22] broom_1.0.1         compiler_4.2.2      httpuv_1.6.9       
[25] modelr_0.1.10       xfun_0.34           pkgconfig_2.0.3    
[28] htmltools_0.5.4     tidyselect_1.2.0    fansi_1.0.3        
[31] later_1.3.0         crayon_1.5.2        tzdb_0.3.0         
[34] withr_2.5.0         grid_4.2.2          xtable_1.8-4       
[37] jsonlite_1.8.3      gtable_0.3.1        lifecycle_1.0.3    
[40] magrittr_2.0.3      scales_1.2.1        cli_3.4.1          
[43] stringi_1.7.8       promises_1.2.0.1    fs_1.5.2           
[46] xml2_1.3.3          ellipsis_0.3.2      generics_0.1.3     
[49] vctrs_0.5.0         tools_4.2.2         bit64_4.0.5        
[52] glue_1.6.2          hms_1.1.2           fastmap_1.1.0      
[55] yaml_2.3.6          timechange_0.1.1    colorspace_2.0-3   
[58] gargle_1.3.0        rvest_1.0.3         knitr_1.40         
[61] haven_2.5.1        </code></pre>
</div>
</div>
<section id="q1.-compile-the-icu-cohort-in-hw2-from-the-google-bigquery-database" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="q1.-compile-the-icu-cohort-in-hw2-from-the-google-bigquery-database"><span class="header-section-number">1</span> Q1. Compile the ICU cohort in HW2 from the Google BigQuery database</h2>
<p>Below is an outline of steps.</p>
<ol type="1">
<li>Load the GCP BigQuery service account token. Please place the service account token (available at BruinLearn) at your MIMIC data folder: <code>~/mimic/biostat-203b-2022winter-3fdc2392ac39.json</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path to the service account token </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>satoken <span class="ot">&lt;-</span> <span class="st">"~/mimic/biostat-203b-2023winter-3fdc2392ac39.json"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># BigQuery authentication using service account</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bq_auth</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> satoken,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">email =</span> <span class="st">"mimiciv-bigquery@biostat-203b-2023winter.iam.gserviceaccount.com"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">scopes =</span> <span class="fu">c</span>(<span class="st">"https://www.googleapis.com/auth/bigquery"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.googleapis.com/auth/cloud-platform"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Connect to BigQuery database <code>mimic4_v1_0_203b</code> in GCP (Google Cloud Platform), using the billing account <code>biostat-203b-2022winter</code>.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the BigQuery database `biostat-203b-2022winter.mimic4_v1_0_203b`</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    bigrquery<span class="sc">::</span><span class="fu">bigquery</span>(),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">project =</span> <span class="st">"biostat-203b-2022winter"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset =</span> <span class="st">"mimic4_v1_0_203b"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">billing =</span> <span class="st">"biostat-203b-2022winter"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;BigQueryConnection&gt;
  Dataset: biostat-203b-2022winter.mimic4_v1_0_203b
  Billing: biostat-203b-2022winter</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>List all tables in the <code>mimic4_v1_0_203b</code> database.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "admissions"  "chartevents" "d_items"     "d_labitems"  "icustays"   
[6] "labevents"   "patients"   </code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Connect to the <code>icustays</code> table.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># full ICU stays table</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>icustays_tble <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"icustays"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT *
FROM `icustays`
# Source:   table&lt;icustays&gt; [?? x 8]
# Database: BigQueryConnection
   subject_id  hadm_id  stay_id first_careunit last_careunit 
        &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;chr&gt;          &lt;chr&gt;         
 1   12776735 20817525 34547665 Neuro Stepdown Neuro Stepdown
 2   16256226 20013290 39289362 Neuro Stepdown Neuro Stepdown
 3   12974563 29618057 32563675 Neuro Stepdown Neuro Stepdown
 4   14609218 20606189 34947848 Neuro Stepdown Neuro Stepdown
 5   12687112 26132667 37445058 Neuro Stepdown Neuro Stepdown
 6   18190935 24712081 30056748 Neuro Stepdown Neuro Stepdown
 7   10404210 22880512 30254828 Neuro Stepdown Neuro Stepdown
 8   12552973 21320643 30261549 Neuro Stepdown Neuro Stepdown
 9   14303051 26559537 30401486 Neuro Stepdown Neuro Stepdown
10   12347959 22779073 30503984 Neuro Stepdown Neuro Stepdown
   intime              outtime               los
   &lt;dttm&gt;              &lt;dttm&gt;              &lt;dbl&gt;
 1 2200-07-12 00:33:00 2200-07-13 16:44:40 1.67 
 2 2150-12-20 16:09:08 2150-12-21 14:58:40 0.951
 3 2138-11-13 23:30:01 2138-11-15 16:25:19 1.71 
 4 2174-06-28 21:13:00 2174-07-05 17:01:32 6.83 
 5 2162-05-31 18:08:45 2162-06-04 10:16:13 3.67 
 6 2115-12-08 09:39:45 2115-12-12 02:36:52 3.71 
 7 2161-03-03 18:30:00 2161-03-05 18:10:31 1.99 
 8 2135-09-21 18:12:03 2135-09-23 12:56:46 1.78 
 9 2175-11-20 01:02:00 2175-11-21 16:06:17 1.63 
10 2140-07-11 17:54:14 2140-07-19 13:01:05 7.80 
# … with more rows</code></pre>
</div>
</div>
<p>We only keep the first ICU stay. Following code is kind of a hack, using the <code>summarise_all(min)</code> function. It seems that <code>slice_min()</code>, <code>slice_head()</code>, <code>distinct(, .keep_all = TRUE)</code> don’t work with <code>dbplyr</code>+<code>bigrquery</code> at the moment.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>icustays_tble <span class="ot">&lt;-</span> icustays_tble <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, intime) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subject_id) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(min) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(icustays_tble, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"subject_id"</span>, <span class="st">"intime"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values are always removed in SQL.
Use `MIN(x, na.rm = TRUE)` to silence this warning
This warning is displayed only once per session.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)

# Source:   lazy query [?? x 8]
# Database: BigQueryConnection
   subject_id intime               hadm_id  stay_id first_careunit
        &lt;int&gt; &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;chr&gt;         
 1   12776735 2200-07-12 00:33:00 20817525 34547665 Neuro Stepdown
 2   16256226 2150-12-20 16:09:08 20013290 39289362 Neuro Stepdown
 3   12974563 2138-11-13 23:30:01 29618057 32563675 Neuro Stepdown
 4   14609218 2174-06-28 21:13:00 20606189 34947848 Neuro Stepdown
 5   12687112 2162-05-31 18:08:45 26132667 37445058 Neuro Stepdown
 6   18190935 2115-11-12 23:23:32 21137829 34338402 Neuro Stepdown
 7   10404210 2161-03-03 18:30:00 22880512 30254828 Neuro Stepdown
 8   12552973 2135-09-21 18:12:03 21320643 30261549 Neuro Stepdown
 9   14303051 2175-11-20 01:02:00 26559537 30401486 Neuro Stepdown
10   12347959 2140-07-11 17:54:14 22779073 30503984 Neuro Stepdown
   last_careunit  outtime               los
   &lt;chr&gt;          &lt;dttm&gt;              &lt;dbl&gt;
 1 Neuro Stepdown 2200-07-13 16:44:40 1.67 
 2 Neuro Stepdown 2150-12-21 14:58:40 0.951
 3 Neuro Stepdown 2138-11-15 16:25:19 1.71 
 4 Neuro Stepdown 2174-07-05 17:01:32 6.83 
 5 Neuro Stepdown 2162-06-04 10:16:13 3.67 
 6 Neuro Stepdown 2115-11-15 18:06:26 2.78 
 7 Neuro Stepdown 2161-03-05 18:10:31 1.99 
 8 Neuro Stepdown 2135-09-23 12:56:46 1.78 
 9 Neuro Stepdown 2175-11-21 16:06:17 1.63 
10 Neuro Stepdown 2140-07-19 13:01:05 7.80 
# … with more rows</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Connect to the <code>admissions</code> table and only keep the patients who have a match in <code>icustays_tble</code> (according to <code>subject_id</code> and <code>hadm_id</code>).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # </span><span class="al">TODO</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>admissions_tble <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"admissions"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subject_id, hadm_id) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(icustays_tble, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'subject_id'</span>, <span class="st">'hadm_id'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT *
FROM `admissions`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:     lazy query [?? x 15]
# Database:   BigQueryConnection
# Ordered by: subject_id, hadm_id
   subject_id  hadm_id admittime           dischtime           deathtime
        &lt;int&gt;    &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;   
 1   17400716 24292388 2175-07-18 22:49:00 2175-07-30 15:45:00 NA       
 2   18091552 21988069 2147-01-28 00:35:00 2147-02-02 16:00:00 NA       
 3   19159928 27601897 2157-03-18 00:23:00 2157-03-20 15:20:00 NA       
 4   12695005 24869134 2117-11-04 18:31:00 2117-11-10 15:30:00 NA       
 5   10835593 28296785 2114-08-06 23:58:00 2114-08-12 16:34:00 NA       
 6   13898167 24278064 2113-08-28 14:42:00 2113-09-08 14:47:00 NA       
 7   17428389 21797984 2128-11-18 01:47:00 2128-11-22 19:20:00 NA       
 8   16328934 25220803 2193-08-15 00:30:00 2193-08-16 15:53:00 NA       
 9   18214183 21965672 2146-09-19 19:02:00 2146-09-22 16:12:00 NA       
10   18982574 27772075 2130-12-15 23:04:00 2130-12-20 16:27:00 NA       
   admission_type admission_location     discharge_location       insurance
   &lt;chr&gt;          &lt;chr&gt;                  &lt;chr&gt;                    &lt;chr&gt;    
 1 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Medicare 
 2 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Medicare 
 3 EW EMER.       EMERGENCY ROOM         HOME                     Medicare 
 4 EW EMER.       EMERGENCY ROOM         SKILLED NURSING FACILITY Medicare 
 5 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Other    
 6 EW EMER.       EMERGENCY ROOM         SKILLED NURSING FACILITY Medicare 
 7 EW EMER.       TRANSFER FROM HOSPITAL SKILLED NURSING FACILITY Other    
 8 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Medicare 
 9 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Medicare 
10 EW EMER.       EMERGENCY ROOM         HOME HEALTH CARE         Medicare 
   language marital_status ethnicity edregtime           edouttime          
   &lt;chr&gt;    &lt;chr&gt;          &lt;chr&gt;     &lt;dttm&gt;              &lt;dttm&gt;             
 1 ENGLISH  WIDOWED        ASIAN     2175-07-18 18:25:00 2175-07-19 00:18:00
 2 ENGLISH  WIDOWED        WHITE     2147-01-27 15:43:00 2147-01-28 01:38:00
 3 ?        WIDOWED        WHITE     2157-03-17 22:01:00 2157-03-18 01:56:00
 4 ENGLISH  WIDOWED        WHITE     2117-11-04 16:14:00 2117-11-04 19:45:00
 5 ENGLISH  WIDOWED        WHITE     2114-08-06 21:02:00 2114-08-07 00:18:00
 6 ENGLISH  WIDOWED        WHITE     2113-08-28 10:00:00 2113-08-28 16:53:00
 7 ENGLISH  WIDOWED        WHITE     2128-11-17 22:38:00 2128-11-18 02:30:00
 8 ?        WIDOWED        WHITE     2193-08-14 20:36:00 2193-08-15 01:38:00
 9 ENGLISH  WIDOWED        WHITE     2146-09-19 16:37:00 2146-09-19 20:20:00
10 ?        WIDOWED        WHITE     2130-12-15 17:31:00 2130-12-16 00:18:00
   hospital_expire_flag
                  &lt;int&gt;
 1                    0
 2                    0
 3                    0
 4                    0
 5                    0
 6                    0
 7                    0
 8                    0
 9                    0
10                    0
# … with more rows</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Connect to the <code>patients</code> table and only keep the patients who have a match in <code>icustays_tble</code> (according to <code>subject_id</code>).</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>patients_tble <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"patients"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(subject_id) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(icustays_tble, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'subject_id'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT *
FROM `patients`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:     lazy query [?? x 6]
# Database:   BigQueryConnection
# Ordered by: subject_id
   subject_id gender anchor_age anchor_year anchor_year_group dod   
        &lt;int&gt; &lt;chr&gt;       &lt;int&gt;       &lt;int&gt; &lt;chr&gt;             &lt;date&gt;
 1   19137716 F              18        2111 2008 - 2010       NA    
 2   19077387 F              18        2112 2017 - 2019       NA    
 3   11155072 M              18        2113 2011 - 2013       NA    
 4   17945455 F              18        2113 2014 - 2016       NA    
 5   17689255 F              18        2113 2017 - 2019       NA    
 6   10894885 F              18        2114 2008 - 2010       NA    
 7   15175657 M              18        2114 2014 - 2016       NA    
 8   17600374 F              18        2118 2014 - 2016       NA    
 9   16501289 M              18        2118 2017 - 2019       NA    
10   10141487 F              18        2119 2017 - 2019       NA    
# … with more rows</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Connect to the <code>labevents</code> table and retrieve a subset that only contain subjects who appear in <code>icustays_tble</code> and the lab items listed in HW2.</li>
</ol>
<p><strong>Create the dictionary file of items</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dic_lab <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"d_labitems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>labevents_tble <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"labevents"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(itemid <span class="sc">%in%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="dv">50912</span>, <span class="dv">50971</span>, <span class="dv">50983</span>, <span class="dv">50902</span>, <span class="dv">50882</span>, <span class="dv">51221</span>, <span class="dv">51301</span>, <span class="dv">50931</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(icustays_tble, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'subject_id'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(dic_lab, <span class="fu">c</span>(itemid, label)), <span class="at">by =</span> <span class="st">'itemid'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Remove space in the labels</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, label)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 16]
# Database: BigQueryConnection
   labevent_id subject_id  hadm_id specimen_id itemid charttime          
         &lt;int&gt;      &lt;int&gt;    &lt;int&gt;       &lt;int&gt;  &lt;int&gt; &lt;dttm&gt;             
 1       67754   10004720       NA    21563648  51301 2184-01-06 15:40:00
 2       72579   10005348 29496232    43585486  50902 2128-09-10 19:30:00
 3       96484   10007677 27180483    41219647  51301 2120-12-05 08:13:00
 4       96809   10007677 27180483    62479484  51221 2120-12-13 07:55:00
 5      420207   10035168       NA    35330898  51221 2145-12-02 10:25:00
 6      427294   10035631 24912093    66305811  50971 2112-10-26 00:07:00
 7      429404   10035631       NA    49648509  50902 2113-01-14 09:15:00
 8      435896   10035631 29276678    88609350  50912 2116-03-09 05:31:00
 9      552296   10047172       NA    90157695  51301 2162-11-01 10:20:00
10      553032   10047172 24433031    26286914  50902 2163-04-26 04:28:00
   storetime           value valuenum valueuom ref_range_lower ref_range_upper
   &lt;dttm&gt;              &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;           &lt;dbl&gt;
 1 2184-01-06 19:22:00 5.9        5.9 K/uL                 4              11  
 2 2128-09-10 20:26:00 102      102   mEq/L               96             108  
 3 2120-12-05 08:54:00 13.7      13.7 K/uL                 4              10  
 4 2120-12-13 09:14:00 25.5      25.5 %                   34              45  
 5 2145-12-02 10:59:00 33.7      33.7 %                   36              48  
 6 2112-10-26 01:37:00 4.1        4.1 mEq/L                3.3             5.1
 7 2113-01-14 10:26:00 104      104   mEq/L               96             108  
 8 2116-03-09 06:36:00 2.1        2.1 mg/dL                0.5             1.2
 9 2162-11-01 10:36:00 5.8        5.8 K/uL                 4              10  
10 2163-04-26 06:00:00 93        93   mEq/L               96             108  
   flag     priority comments label          
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          
 1 &lt;NA&gt;     ROUTINE  &lt;NA&gt;     WhiteBloodCells
 2 &lt;NA&gt;     STAT     &lt;NA&gt;     Chloride       
 3 abnormal STAT     &lt;NA&gt;     WhiteBloodCells
 4 abnormal ROUTINE  &lt;NA&gt;     Hematocrit     
 5 abnormal STAT     &lt;NA&gt;     Hematocrit     
 6 &lt;NA&gt;     ROUTINE  &lt;NA&gt;     Potassium      
 7 &lt;NA&gt;     STAT     &lt;NA&gt;     Chloride       
 8 abnormal STAT     &lt;NA&gt;     Creatinine     
 9 &lt;NA&gt;     STAT     &lt;NA&gt;     WhiteBloodCells
10 abnormal STAT     &lt;NA&gt;     Chloride       
# … with more rows</code></pre>
</div>
</div>
<p>Only keep the first lab measurements during ICU stay and pivot lab items to become variables/columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>labevents_tble2 <span class="ot">&lt;-</span> labevents_tble <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(icustays_tble, subject_id, intime, outtime, stay_id), </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"subject_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(charttime <span class="sc">&gt;=</span> intime <span class="sc">&amp;</span> charttime <span class="sc">&lt;=</span> outtime) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subject_id, itemid) <span class="sc">%&gt;%</span> <span class="co">#group by lab items</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(charttime, <span class="at">.by_group =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(min) <span class="sc">%&gt;%</span> <span class="co">#keep the first observation timewise</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, stay_id, label, valuenum) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> valuenum) <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `subject_id`, `stay_id`, MAX(IF(`label` = 'Sodium', `valuenum`, NULL)) AS `Sodium`, MAX(IF(`label` = 'Glucose', `valuenum`, NULL)) AS `Glucose`, MAX(IF(`label` = 'Chloride', `valuenum`, NULL)) AS `Chloride`, MAX(IF(`label` = 'Potassium', `valuenum`, NULL)) AS `Potassium`, MAX(IF(`label` = 'Creatinine', `valuenum`, NULL)) AS `Creatinine`, MAX(IF(`label` = 'Hematocrit', `valuenum`, NULL)) AS `Hematocrit`, MAX(IF(`label` = 'Bicarbonate', `valuenum`, NULL)) AS `Bicarbonate`, MAX(IF(`label` = 'WhiteBloodCells', `valuenum`, NULL)) AS `WhiteBloodCells`
FROM (SELECT `subject_id`, `stay_id`, `label`, `valuenum`
FROM (SELECT `subject_id`, `itemid`, MIN(`labevent_id`) AS `labevent_id`, MIN(`hadm_id`) AS `hadm_id`, MIN(`specimen_id`) AS `specimen_id`, MIN(`charttime`) AS `charttime`, MIN(`storetime`) AS `storetime`, MIN(`value`) AS `value`, MIN(`valuenum`) AS `valuenum`, MIN(`valueuom`) AS `valueuom`, MIN(`ref_range_lower`) AS `ref_range_lower`, MIN(`ref_range_upper`) AS `ref_range_upper`, MIN(`flag`) AS `flag`, MIN(`priority`) AS `priority`, MIN(`comments`) AS `comments`, MIN(`label`) AS `label`, MIN(`intime`) AS `intime`, MIN(`outtime`) AS `outtime`, MIN(`stay_id`) AS `stay_id`
FROM (SELECT `labevent_id`, `LHS`.`subject_id` AS `subject_id`, `hadm_id`, `specimen_id`, `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, `label`, `intime`, `outtime`, `stay_id`
FROM (SELECT `labevent_id`, `subject_id`, `hadm_id`, `specimen_id`, `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, REGEXP_REPLACE(`label`, ' ', '') AS `label`
FROM (SELECT `labevent_id`, `subject_id`, `hadm_id`, `specimen_id`, `LHS`.`itemid` AS `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, `label`
FROM (SELECT * FROM (SELECT *
FROM `labevents`
WHERE (`itemid` IN (50912.0, 50971.0, 50983.0, 50902.0, 50882.0, 51221.0, 51301.0, 50931.0))) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `LHS`
LEFT JOIN (SELECT `itemid`, `label`
FROM `d_labitems`) `RHS`
ON (`LHS`.`itemid` = `RHS`.`itemid`)
) `q01`) `LHS`
LEFT JOIN (SELECT `subject_id`, `intime`, `outtime`, `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `q01`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q02`
WHERE (`charttime` &gt;= `intime` AND `charttime` &lt;= `outtime`)
GROUP BY `subject_id`, `itemid`) `q03`) `q04`
GROUP BY `subject_id`, `stay_id`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 10]
# Database: BigQueryConnection
# Groups:   subject_id
   subject_id  stay_id Sodium Glucose Chloride Potassium Creatinine Hematocrit
        &lt;int&gt;    &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1   10035631 30932571    126      96       86       3.4        1         19.4
 2   10142412 34384364    138     109      109       3.7        0.7       26.3
 3   10154271 33513039    138      94      102       3.8        1.1       32.7
 4   10156119 32532366    138      70      100       2.1        0.3       18.2
 5   10171038 34994399    136     130      104       4.2        1         36.9
 6   10171525 34714152    131      65      100       3.7        0.6       27.4
 7   10222191 32259031    102      69       86       3          0.7       16.8
 8   10240592 31988980    134      76      104       3          3.1       19.4
 9   10257607 37679326    142      89      107       3.2        1.2       13  
10   10258162 38570280    132      68       98       3.6        0.4       21.9
   Bicarbonate WhiteBloodCells
         &lt;dbl&gt;           &lt;dbl&gt;
 1          16             0.1
 2          20             9.3
 3          26             8.9
 4          11            16.7
 5          23             8  
 6          15             8.6
 7          12             7.6
 8          14             6.5
 9          17            12.3
10          13             1.4
# … with more rows</code></pre>
</div>
</div>
<ol start="7" type="1">
<li>Connect to <code>chartevents</code> table and retrieve a subset that only contain subjects who appear in <code>icustays_tble</code> and the chart events listed in HW2.</li>
</ol>
<p><strong>Create dictionary file with chart measurements id</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dic_chart <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"d_items"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   table&lt;d_items&gt; [?? x 9]
# Database: BigQueryConnection
   itemid label             abbreviation      linksto    
    &lt;int&gt; &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;      
 1 223933 Heat Sounds       Heat Sounds       chartevents
 2 223934 Dorsal PedPulse R Dorsal PedPulse R chartevents
 3 223935 PostTib. Pulses R PostTib Pulses R  chartevents
 4 223936 Radial Pulse R    Radial Pulse R    chartevents
 5 223938 Ulnar Pulse R     Ulnar Pulse R     chartevents
 6 223939 Brachial Pulse R  Brachial Pulse R  chartevents
 7 223940 Femoral Pulse R   Femoral Pulse R   chartevents
 8 223941 Popliteal Pulse R Popliteal Pulse R chartevents
 9 223943 Dorsal PedPulse L Dorsal PedPulse L chartevents
10 223944 Brachial Pulse L  Brachial Pulse L  chartevents
   category                unitname param_type lownormalvalue highnormalvalue
   &lt;chr&gt;                   &lt;chr&gt;    &lt;chr&gt;               &lt;dbl&gt;           &lt;dbl&gt;
 1 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 2 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 3 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 4 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 5 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 6 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 7 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 8 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
 9 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
10 Cardiovascular (Pulses) &lt;NA&gt;     Text                   NA              NA
# … with more rows</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chartevents_tble <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"chartevents"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(itemid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">220045</span>, <span class="dv">220181</span>, <span class="dv">220179</span>, <span class="dv">223761</span>, <span class="dv">220210</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(icustays_tble, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'subject_id'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(dic_chart, <span class="fu">c</span>(itemid, label)), <span class="at">by =</span> <span class="st">'itemid'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">""</span>, label)) <span class="sc">%&gt;%</span> <span class="co">#Remove space in the labels</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stay_id) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `subject_id`, `hadm_id`, `charttime`, `storetime`, `itemid`, `value`, `valuenum`, `valueuom`, `warning`, REGEXP_REPLACE(`label`, ' ', '') AS `label`
FROM (SELECT `subject_id`, `hadm_id`, `stay_id`, `charttime`, `storetime`, `LHS`.`itemid` AS `itemid`, `value`, `valuenum`, `valueuom`, `warning`, `label`
FROM (SELECT * FROM (SELECT *
FROM `chartevents`
WHERE (`itemid` IN (220045.0, 220181.0, 220179.0, 223761.0, 220210.0))) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `LHS`
LEFT JOIN (SELECT `itemid`, `label`
FROM `d_items`) `RHS`
ON (`LHS`.`itemid` = `RHS`.`itemid`)
) `q01`
# Source:   lazy query [?? x 10]
# Database: BigQueryConnection
   subject_id  hadm_id charttime           storetime           itemid value
        &lt;int&gt;    &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;               &lt;int&gt; &lt;chr&gt;
 1   11677053 22241674 2116-09-19 04:00:00 2116-09-19 04:09:00 223761 99.1 
 2   13952645 23932779 2185-07-13 00:00:00 2185-07-13 00:06:00 223761 99.8 
 3   19936782 28486132 2154-02-12 11:00:00 2154-02-12 11:47:00 223761 98.2 
 4   12683197 23772093 2145-08-03 00:00:00 2145-08-03 00:35:00 223761 100.5
 5   16923322 23848703 2113-08-18 00:00:00 2113-08-18 00:52:00 223761 98   
 6   19033110 23390717 2186-02-03 04:00:00 2186-02-03 04:52:00 223761 96.5 
 7   10010867 22429197 2148-01-03 08:00:00 2148-01-03 08:09:00 223761 98   
 8   10252795 21348633 2149-11-15 08:00:00 2149-11-15 12:28:00 223761 97.7 
 9   14808031 27252601 2137-02-11 03:00:00 2137-02-11 03:03:00 223761 97.5 
10   15284020 29267157 2125-01-19 16:00:00 2125-01-19 17:06:00 223761 100.8
   valuenum valueuom warning label                
      &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;                
 1     99.1 °F             0 TemperatureFahrenheit
 2     99.8 °F             0 TemperatureFahrenheit
 3     98.2 °F             0 TemperatureFahrenheit
 4    100.  °F             0 TemperatureFahrenheit
 5     98   °F             0 TemperatureFahrenheit
 6     96.5 °F             0 TemperatureFahrenheit
 7     98   °F             0 TemperatureFahrenheit
 8     97.7 °F             0 TemperatureFahrenheit
 9     97.5 °F             0 TemperatureFahrenheit
10    101.  °F             0 TemperatureFahrenheit
# … with more rows</code></pre>
</div>
</div>
<p>Only keep the first chart events during ICU stay and pivot chart events to become variables/columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>chartevents_tble2 <span class="ot">&lt;-</span> chartevents_tble <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(icustays_tble, subject_id, intime, outtime, stay_id), </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"subject_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(charttime <span class="sc">&gt;=</span> intime <span class="sc">&amp;</span> charttime <span class="sc">&lt;=</span> outtime) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subject_id, itemid) <span class="sc">%&gt;%</span> <span class="co">#group by lab items</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(charttime, <span class="at">.by_group =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(min) <span class="sc">%&gt;%</span> <span class="co">#keep the first observation timewise</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, stay_id, label, valuenum) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> valuenum) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `subject_id`, `stay_id`, MAX(IF(`label` = 'TemperatureFahrenheit', `valuenum`, NULL)) AS `TemperatureFahrenheit`, MAX(IF(`label` = 'NonInvasiveBloodPressuresystolic', `valuenum`, NULL)) AS `NonInvasiveBloodPressuresystolic`, MAX(IF(`label` = 'NonInvasiveBloodPressuremean', `valuenum`, NULL)) AS `NonInvasiveBloodPressuremean`, MAX(IF(`label` = 'RespiratoryRate', `valuenum`, NULL)) AS `RespiratoryRate`, MAX(IF(`label` = 'HeartRate', `valuenum`, NULL)) AS `HeartRate`
FROM (SELECT `subject_id`, `stay_id`, `label`, `valuenum`
FROM (SELECT `subject_id`, `itemid`, MIN(`hadm_id`) AS `hadm_id`, MIN(`charttime`) AS `charttime`, MIN(`storetime`) AS `storetime`, MIN(`value`) AS `value`, MIN(`valuenum`) AS `valuenum`, MIN(`valueuom`) AS `valueuom`, MIN(`warning`) AS `warning`, MIN(`label`) AS `label`, MIN(`intime`) AS `intime`, MIN(`outtime`) AS `outtime`, MIN(`stay_id`) AS `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `hadm_id`, `charttime`, `storetime`, `itemid`, `value`, `valuenum`, `valueuom`, `warning`, `label`, `intime`, `outtime`, `stay_id`
FROM (SELECT `subject_id`, `hadm_id`, `charttime`, `storetime`, `itemid`, `value`, `valuenum`, `valueuom`, `warning`, REGEXP_REPLACE(`label`, ' ', '') AS `label`
FROM (SELECT `subject_id`, `hadm_id`, `stay_id`, `charttime`, `storetime`, `LHS`.`itemid` AS `itemid`, `value`, `valuenum`, `valueuom`, `warning`, `label`
FROM (SELECT * FROM (SELECT *
FROM `chartevents`
WHERE (`itemid` IN (220045.0, 220181.0, 220179.0, 223761.0, 220210.0))) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `LHS`
LEFT JOIN (SELECT `itemid`, `label`
FROM `d_items`) `RHS`
ON (`LHS`.`itemid` = `RHS`.`itemid`)
) `q01`) `LHS`
LEFT JOIN (SELECT `subject_id`, `intime`, `outtime`, `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `q01`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q02`
WHERE (`charttime` &gt;= `intime` AND `charttime` &lt;= `outtime`)
GROUP BY `subject_id`, `itemid`) `q03`) `q04`
GROUP BY `subject_id`, `stay_id`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 7]
# Database: BigQueryConnection
# Groups:   subject_id
   subject_id  stay_id TemperatureFahrenheit NonInvasiveBloodPressuresystolic
        &lt;int&gt;    &lt;int&gt;                 &lt;dbl&gt;                            &lt;dbl&gt;
 1   11984981 34693433                  97.4                               68
 2   18766606 37608114                  97.7                               65
 3   10839978 30667575                  96                                 91
 4   18632695 37397490                  96.9                               73
 5   13160640 38591089                  96.2                               76
 6   18077771 39048546                  94.5                               69
 7   11222720 36658048                  97.2                               92
 8   19437332 31307923                  97.3                              119
 9   15324792 38627763                  95.8                              100
10   13354079 37240965                  96.1                               87
   NonInvasiveBloodPressuremean RespiratoryRate HeartRate
                          &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;
 1                           46               0        55
 2                           51              11        52
 3                           57               7        71
 4                           44               6         0
 5                           46               0        56
 6                           46               0        59
 7                           56              14        49
 8                           74               9        16
 9                           67               7        68
10                           59              12        80
# … with more rows</code></pre>
</div>
</div>
<ol start="8" type="1">
<li>Put things together. This step is similar to Q7 of HW2. Using one chain of pipes <code>%&gt;%</code> to perform following data wrangling steps: (i) start with the <code>icustays_tble</code> for the first ICU stay of each unique patient, (ii) merge in admissions and patients tables, (iii) keep adults only (age at admission &gt;= 18), (iv) merge in the labevents and chartevents tables, (v) create an indicator for 30-day mortality, (vi) save the final tibble to an <code>icu_cohort.rds</code> R data file in the <code>mimiciv_shiny</code> folder.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a directory mimiciv_shiny</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">"mimiciv_shiny"</span>)) {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">"mimiciv_shiny"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>icu_cohort <span class="ot">&lt;-</span> icustays_tble <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subject_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(min) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(patients_tble, <span class="at">by =</span> <span class="st">'subject_id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(admissions_tble, <span class="sc">-</span>hadm_id), </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">'subject_id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Filter age &gt; 18</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_real =</span> anchor_age <span class="sc">+</span> <span class="fu">year</span>(admittime) <span class="sc">-</span> anchor_year) <span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_real <span class="sc">&gt;</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(labevents_tble2, <span class="sc">-</span>stay_id),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">'subject_id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(chartevents_tble2, <span class="sc">-</span>stay_id),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">'subject_id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#create indicator</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">thirty_day_mort =</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(<span class="fu">is.na</span>(deathtime), <span class="cn">FALSE</span>,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">day</span>(deathtime <span class="sc">-</span> admittime) <span class="sc">&lt;=</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`, `age_real`, `Sodium`, `Glucose`, `Chloride`, `Potassium`, `Creatinine`, `Hematocrit`, `Bicarbonate`, `WhiteBloodCells`, `TemperatureFahrenheit`, `NonInvasiveBloodPressuresystolic`, `NonInvasiveBloodPressuremean`, `RespiratoryRate`, `HeartRate`, IF(((`deathtime`) IS NULL), FALSE, EXTRACT(day FROM `deathtime` - `admittime`) &lt;= 30.0) AS `thirty_day_mort`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`, `age_real`, `Sodium`, `Glucose`, `Chloride`, `Potassium`, `Creatinine`, `Hematocrit`, `Bicarbonate`, `WhiteBloodCells`, `TemperatureFahrenheit`, `NonInvasiveBloodPressuresystolic`, `NonInvasiveBloodPressuremean`, `RespiratoryRate`, `HeartRate`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`, `age_real`, `Sodium`, `Glucose`, `Chloride`, `Potassium`, `Creatinine`, `Hematocrit`, `Bicarbonate`, `WhiteBloodCells`
FROM (SELECT *
FROM (SELECT `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`, `anchor_age` + EXTRACT(year FROM `admittime`) - `anchor_year` AS `age_real`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`, `gender`, `anchor_age`, `anchor_year`, `anchor_year_group`, `dod`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`, MIN(`hadm_id`) AS `hadm_id`, MIN(`stay_id`) AS `stay_id`, MIN(`first_careunit`) AS `first_careunit`, MIN(`last_careunit`) AS `last_careunit`, MIN(`outtime`) AS `outtime`, MIN(`los`) AS `los`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN (SELECT * FROM (SELECT *
FROM `patients`) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `LHS`
LEFT JOIN (SELECT `subject_id`, `admittime`, `dischtime`, `deathtime`, `admission_type`, `admission_location`, `discharge_location`, `insurance`, `language`, `marital_status`, `ethnicity`, `edregtime`, `edouttime`, `hospital_expire_flag`
FROM (SELECT * FROM (SELECT *
FROM `admissions`) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`hadm_id` = `RHS`.`hadm_id`)
)) `q01`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q02`) `q03`
WHERE (`age_real` &gt; 18.0)) `LHS`
LEFT JOIN (SELECT `subject_id`, `Sodium`, `Glucose`, `Chloride`, `Potassium`, `Creatinine`, `Hematocrit`, `Bicarbonate`, `WhiteBloodCells`
FROM (SELECT `subject_id`, `stay_id`, MAX(IF(`label` = 'Sodium', `valuenum`, NULL)) AS `Sodium`, MAX(IF(`label` = 'Glucose', `valuenum`, NULL)) AS `Glucose`, MAX(IF(`label` = 'Chloride', `valuenum`, NULL)) AS `Chloride`, MAX(IF(`label` = 'Potassium', `valuenum`, NULL)) AS `Potassium`, MAX(IF(`label` = 'Creatinine', `valuenum`, NULL)) AS `Creatinine`, MAX(IF(`label` = 'Hematocrit', `valuenum`, NULL)) AS `Hematocrit`, MAX(IF(`label` = 'Bicarbonate', `valuenum`, NULL)) AS `Bicarbonate`, MAX(IF(`label` = 'WhiteBloodCells', `valuenum`, NULL)) AS `WhiteBloodCells`
FROM (SELECT `subject_id`, `stay_id`, `label`, `valuenum`
FROM (SELECT `subject_id`, `itemid`, MIN(`labevent_id`) AS `labevent_id`, MIN(`hadm_id`) AS `hadm_id`, MIN(`specimen_id`) AS `specimen_id`, MIN(`charttime`) AS `charttime`, MIN(`storetime`) AS `storetime`, MIN(`value`) AS `value`, MIN(`valuenum`) AS `valuenum`, MIN(`valueuom`) AS `valueuom`, MIN(`ref_range_lower`) AS `ref_range_lower`, MIN(`ref_range_upper`) AS `ref_range_upper`, MIN(`flag`) AS `flag`, MIN(`priority`) AS `priority`, MIN(`comments`) AS `comments`, MIN(`label`) AS `label`, MIN(`intime`) AS `intime`, MIN(`outtime`) AS `outtime`, MIN(`stay_id`) AS `stay_id`
FROM (SELECT `labevent_id`, `LHS`.`subject_id` AS `subject_id`, `hadm_id`, `specimen_id`, `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, `label`, `intime`, `outtime`, `stay_id`
FROM (SELECT `labevent_id`, `subject_id`, `hadm_id`, `specimen_id`, `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, REGEXP_REPLACE(`label`, ' ', '') AS `label`
FROM (SELECT `labevent_id`, `subject_id`, `hadm_id`, `specimen_id`, `LHS`.`itemid` AS `itemid`, `charttime`, `storetime`, `value`, `valuenum`, `valueuom`, `ref_range_lower`, `ref_range_upper`, `flag`, `priority`, `comments`, `label`
FROM (SELECT * FROM (SELECT *
FROM `labevents`
WHERE (`itemid` IN (50912.0, 50971.0, 50983.0, 50902.0, 50882.0, 51221.0, 51301.0, 50931.0))) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `LHS`
LEFT JOIN (SELECT `itemid`, `label`
FROM `d_labitems`) `RHS`
ON (`LHS`.`itemid` = `RHS`.`itemid`)
) `q01`) `LHS`
LEFT JOIN (SELECT `subject_id`, `intime`, `outtime`, `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `q01`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q02`
WHERE (`charttime` &gt;= `intime` AND `charttime` &lt;= `outtime`)
GROUP BY `subject_id`, `itemid`) `q03`) `q04`
GROUP BY `subject_id`, `stay_id`) `q05`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `LHS`
LEFT JOIN (SELECT `subject_id`, `TemperatureFahrenheit`, `NonInvasiveBloodPressuresystolic`, `NonInvasiveBloodPressuremean`, `RespiratoryRate`, `HeartRate`
FROM (SELECT `subject_id`, `stay_id`, MAX(IF(`label` = 'TemperatureFahrenheit', `valuenum`, NULL)) AS `TemperatureFahrenheit`, MAX(IF(`label` = 'NonInvasiveBloodPressuresystolic', `valuenum`, NULL)) AS `NonInvasiveBloodPressuresystolic`, MAX(IF(`label` = 'NonInvasiveBloodPressuremean', `valuenum`, NULL)) AS `NonInvasiveBloodPressuremean`, MAX(IF(`label` = 'RespiratoryRate', `valuenum`, NULL)) AS `RespiratoryRate`, MAX(IF(`label` = 'HeartRate', `valuenum`, NULL)) AS `HeartRate`
FROM (SELECT `subject_id`, `stay_id`, `label`, `valuenum`
FROM (SELECT `subject_id`, `itemid`, MIN(`hadm_id`) AS `hadm_id`, MIN(`charttime`) AS `charttime`, MIN(`storetime`) AS `storetime`, MIN(`value`) AS `value`, MIN(`valuenum`) AS `valuenum`, MIN(`valueuom`) AS `valueuom`, MIN(`warning`) AS `warning`, MIN(`label`) AS `label`, MIN(`intime`) AS `intime`, MIN(`outtime`) AS `outtime`, MIN(`stay_id`) AS `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `hadm_id`, `charttime`, `storetime`, `itemid`, `value`, `valuenum`, `valueuom`, `warning`, `label`, `intime`, `outtime`, `stay_id`
FROM (SELECT `subject_id`, `hadm_id`, `charttime`, `storetime`, `itemid`, `value`, `valuenum`, `valueuom`, `warning`, REGEXP_REPLACE(`label`, ' ', '') AS `label`
FROM (SELECT `subject_id`, `hadm_id`, `stay_id`, `charttime`, `storetime`, `LHS`.`itemid` AS `itemid`, `value`, `valuenum`, `valueuom`, `warning`, `label`
FROM (SELECT * FROM (SELECT *
FROM `chartevents`
WHERE (`itemid` IN (220045.0, 220181.0, 220179.0, 223761.0, 220210.0))) `LHS`
WHERE EXISTS (
  SELECT 1 FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `RHS`
  WHERE (`LHS`.`subject_id` = `RHS`.`subject_id`)
)) `LHS`
LEFT JOIN (SELECT `itemid`, `label`
FROM `d_items`) `RHS`
ON (`LHS`.`itemid` = `RHS`.`itemid`)
) `q01`) `LHS`
LEFT JOIN (SELECT `subject_id`, `intime`, `outtime`, `stay_id`
FROM (SELECT `LHS`.`subject_id` AS `subject_id`, `LHS`.`intime` AS `intime`, `hadm_id`, `stay_id`, `first_careunit`, `last_careunit`, `outtime`, `los`
FROM (SELECT `subject_id`, MIN(`intime`) AS `intime`
FROM (SELECT `subject_id`, `intime`
FROM `icustays`) `q01`
GROUP BY `subject_id`) `LHS`
LEFT JOIN `icustays` AS `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id` AND `LHS`.`intime` = `RHS`.`intime`)
) `q01`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q02`
WHERE (`charttime` &gt;= `intime` AND `charttime` &lt;= `outtime`)
GROUP BY `subject_id`, `itemid`) `q03`) `q04`
GROUP BY `subject_id`, `stay_id`) `q05`) `RHS`
ON (`LHS`.`subject_id` = `RHS`.`subject_id`)
) `q06`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   lazy query [?? x 41]
# Database: BigQueryConnection
   subject_id intime               hadm_id  stay_id first_careunit
        &lt;int&gt; &lt;dttm&gt;                 &lt;int&gt;    &lt;int&gt; &lt;chr&gt;         
 1   12776735 2200-07-12 00:33:00 20817525 34547665 Neuro Stepdown
 2   16256226 2150-12-20 16:09:08 20013290 39289362 Neuro Stepdown
 3   12974563 2138-11-13 23:30:01 29618057 32563675 Neuro Stepdown
 4   14609218 2174-06-28 21:13:00 20606189 34947848 Neuro Stepdown
 5   12687112 2162-05-31 18:08:45 26132667 37445058 Neuro Stepdown
 6   18190935 2115-11-12 23:23:32 21137829 34338402 Neuro Stepdown
 7   10404210 2161-03-03 18:30:00 22880512 30254828 Neuro Stepdown
 8   12552973 2135-09-21 18:12:03 21320643 30261549 Neuro Stepdown
 9   14303051 2175-11-20 01:02:00 26559537 30401486 Neuro Stepdown
10   12347959 2140-07-11 17:54:14 22779073 30503984 Neuro Stepdown
   last_careunit  outtime               los gender anchor_age anchor_year
   &lt;chr&gt;          &lt;dttm&gt;              &lt;dbl&gt; &lt;chr&gt;       &lt;int&gt;       &lt;int&gt;
 1 Neuro Stepdown 2200-07-13 16:44:40 1.67  M              72        2192
 2 Neuro Stepdown 2150-12-21 14:58:40 0.951 F              49        2150
 3 Neuro Stepdown 2138-11-15 16:25:19 1.71  F              72        2138
 4 Neuro Stepdown 2174-07-05 17:01:32 6.83  F              69        2174
 5 Neuro Stepdown 2162-06-04 10:16:13 3.67  M              57        2156
 6 Neuro Stepdown 2115-11-15 18:06:26 2.78  F              57        2115
 7 Neuro Stepdown 2161-03-05 18:10:31 1.99  F              46        2161
 8 Neuro Stepdown 2135-09-23 12:56:46 1.78  F              48        2131
 9 Neuro Stepdown 2175-11-21 16:06:17 1.63  F              24        2175
10 Neuro Stepdown 2140-07-19 13:01:05 7.80  F              49        2140
   anchor_year_group dod        admittime           dischtime          
   &lt;chr&gt;             &lt;date&gt;     &lt;dttm&gt;              &lt;dttm&gt;             
 1 2008 - 2010       NA         2200-07-11 22:46:00 2200-07-19 12:00:00
 2 2017 - 2019       NA         2150-12-20 03:00:00 2150-12-21 14:50:00
 3 2014 - 2016       NA         2138-11-13 01:07:00 2138-11-15 15:53:00
 4 2017 - 2019       NA         2174-06-28 20:40:00 2174-07-05 16:45:00
 5 2011 - 2013       NA         2162-05-31 15:36:00 2162-06-04 10:16:00
 6 2017 - 2019       2115-12-11 2115-11-02 18:38:00 2115-11-26 14:30:00
 7 2017 - 2019       NA         2161-03-03 17:45:00 2161-03-05 18:10:00
 8 2011 - 2013       NA         2135-09-21 02:12:00 2135-09-23 12:56:00
 9 2014 - 2016       NA         2175-11-20 00:08:00 2175-11-21 15:30:00
10 2017 - 2019       NA         2140-07-11 17:52:00 2140-07-19 13:00:00
   deathtime admission_type              admission_location    
   &lt;dttm&gt;    &lt;chr&gt;                       &lt;chr&gt;                 
 1 NA        OBSERVATION ADMIT           EMERGENCY ROOM        
 2 NA        SURGICAL SAME DAY ADMISSION PHYSICIAN REFERRAL    
 3 NA        OBSERVATION ADMIT           EMERGENCY ROOM        
 4 NA        OBSERVATION ADMIT           EMERGENCY ROOM        
 5 NA        OBSERVATION ADMIT           PHYSICIAN REFERRAL    
 6 NA        OBSERVATION ADMIT           TRANSFER FROM HOSPITAL
 7 NA        OBSERVATION ADMIT           EMERGENCY ROOM        
 8 NA        SURGICAL SAME DAY ADMISSION PHYSICIAN REFERRAL    
 9 NA        OBSERVATION ADMIT           EMERGENCY ROOM        
10 NA        URGENT                      TRANSFER FROM HOSPITAL
   discharge_location           insurance language marital_status
   &lt;chr&gt;                        &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;         
 1 SKILLED NURSING FACILITY     Medicare  ENGLISH  MARRIED       
 2 HOME                         Other     ENGLISH  SINGLE        
 3 HOME HEALTH CARE             Other     ENGLISH  WIDOWED       
 4 REHAB                        Other     ENGLISH  SINGLE        
 5 HOME                         Other     ENGLISH  SINGLE        
 6 CHRONIC/LONG TERM ACUTE CARE Other     ENGLISH  DIVORCED      
 7 HOME                         Other     ENGLISH  MARRIED       
 8 HOME                         Other     ENGLISH  MARRIED       
 9 HOME                         Other     ENGLISH  SINGLE        
10 REHAB                        Other     ENGLISH  MARRIED       
   ethnicity              edregtime           edouttime          
   &lt;chr&gt;                  &lt;dttm&gt;              &lt;dttm&gt;             
 1 OTHER                  2200-07-11 15:27:00 2200-07-12 00:33:00
 2 OTHER                  NA                  NA                 
 3 WHITE                  2138-11-12 17:26:00 2138-11-13 20:21:00
 4 WHITE                  2174-06-28 18:46:00 2174-06-28 21:13:00
 5 BLACK/AFRICAN AMERICAN 2162-05-31 09:36:00 2162-05-31 19:59:00
 6 WHITE                  2115-11-02 13:59:00 2115-11-02 22:17:00
 7 HISPANIC/LATINO        2161-03-03 13:39:00 2161-03-03 18:30:00
 8 WHITE                  NA                  NA                 
 9 WHITE                  2175-11-19 10:42:00 2175-11-20 01:02:00
10 WHITE                  NA                  NA                 
   hospital_expire_flag age_real Sodium Glucose Chloride Potassium Creatinine
                  &lt;int&gt;    &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1                    0       80    129     106       97       2.7        0.9
 2                    0       49    141      99      108       4          0.5
 3                    0       72    139      78      104       4.4        1  
 4                    0       69    129      94       95       3.5        0.4
 5                    0       63    143      87      105       4.9        7.8
 6                    0       57    130      78       93       3.8        0.4
 7                    0       46    137      99      104       4.1        0.7
 8                    0       52    141     155      104       4          0.7
 9                    0       24    138      85      103       4.1        0.8
10                    0       49    135      81       98       3.7        0.5
   Hematocrit Bicarbonate WhiteBloodCells TemperatureFahrenheit
        &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;                 &lt;dbl&gt;
 1       27.7          22             6.6                  97.8
 2       30.5          21             3.5                  97.7
 3       41.6          16            10.6                  97.9
 4       29.6          23             8.4                  97.5
 5       29.4          19             5.3                  97.7
 6       29.4          23             9.2                  97.6
 7       32.5          26             3.6                  97.6
 8       36.1          22            14.7                  97.9
 9       34.7          24             6.4                  97.6
10       32.1          19             7.6                  97.5
   NonInvasiveBloodPressuresystolic NonInvasiveBloodPressuremean RespiratoryRate
                              &lt;dbl&gt;                        &lt;dbl&gt;           &lt;dbl&gt;
 1                               98                           55              11
 2                               94                           69               5
 3                              123                           80               8
 4                               93                           71               8
 5                              118                           76               0
 6                              114                           85              13
 7                               77                           57              11
 8                              109                           70              10
 9                               71                           50               0
10                              105                           49               7
   HeartRate thirty_day_mort
       &lt;dbl&gt; &lt;lgl&gt;          
 1        51 FALSE          
 2        54 FALSE          
 3        59 FALSE          
 4        65 FALSE          
 5        72 FALSE          
 6        57 FALSE          
 7        67 FALSE          
 8        55 FALSE          
 9        51 FALSE          
10        69 FALSE          
# … with more rows</code></pre>
</div>
</div>
<p><strong>convert the dataset as a tibble and save it as an rds file.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>icu_cohort <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(icu_cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `as.tibble()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` instead.
ℹ The signature and semantics have changed, see `?as_tibble`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?
ORDER BY is ignored in subqueries without LIMIT
ℹ Do you need to move arrange() later in the pipeline or use window_order() instead?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(icu_cohort)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53065</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(icu_cohort, <span class="st">"mimiciv_shiny/icu_cohort.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Close database connection and clear workspace.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q2.-shiny-app" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="q2.-shiny-app"><span class="header-section-number">2</span> Q2. Shiny app</h2>
<p>Develop a Shiny app for exploring the ICU cohort data created in Q1. The app should reside in the <code>mimiciv_shiny</code> folder. The app should provide easy access to the graphical and numerical summaries of variables (demographics, lab measurements, vitals) in the ICU cohort.</p>
<p><strong>Shiny app is in a different file inside the mimiciv_shiny folder</strong></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>